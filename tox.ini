[tox]
envlist = py313, lint, typecheck
skip_missing_interpreters = true

[testenv]
deps =
    -r requirements.txt
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-asyncio>=0.21.0
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest --cov=src --cov-report=term-missing --cov-report=html --cov-fail-under=70

[testenv:lint]
deps =
    ruff>=0.1.0
    black>=24.0.0
    isort>=5.12.0
commands =
    ruff check src tests
    ruff format --check src tests
    black --check src tests
    isort --check-only --diff src tests

[testenv:typecheck]
deps =
    mypy>=1.0.0
    types-all
commands =
    mypy src tests

[testenv:fast]
deps =
    -r requirements.txt
    pytest>=7.0.0
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest -x --tb=short tests/test_models.py tests/test_utils.py tests/test_bugs.py

[testenv:integration]
deps =
    -r requirements.txt
    pytest>=7.0.0
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest -m integration --tb=short

[testenv:ci]
deps =
    -r requirements.txt
    pytest>=7.0.0
    pytest-cov>=4.0.0
setenv =
    PYTHONPATH = {toxinidir}
    CI = true
commands =
    pytest --cov=src --cov-report=term-missing --cov-report=xml --cov-fail-under=70 --junitxml=junit.xml